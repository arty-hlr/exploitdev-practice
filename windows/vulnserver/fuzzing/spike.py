import subprocess
import sys

if len(sys.argv) < 4:
    print('Usage: ./generic_send_tcp host port spike_script SKIPVAR SKIPSTR')
    exit(0)

host,port,script = sys.argv[1:4]
if len(sys.argv) > 5:
    skipvar,skipstr = sys.argv[4:6]
else:
    skipvar,skipstr = ('0','0')

cmd = ['/usr/bin/spike-fuzzer-generic-send_tcp',host,port,script,skipvar,skipstr]
proc = subprocess.Popen(cmd, stdout=subprocess.PIPE)

for i in range(4):
    proc.stdout.readline()
while True:
    variable = proc.stdout.readline().decode().strip()
    line = proc.stdout.readline().decode().strip()
    size = proc.stdout.readline().decode().strip()
    if not 'line read' in line:
        print(prev_var)
        print(prev_size)
        break
    prev_var = variable
    prev_size = size

proc.kill()
